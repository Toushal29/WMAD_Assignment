{% extends 'admin_site/base_admin.html' %}

{% block title %}Edit Menu{% endblock %}

{% block content %}
<h1 style="margin-bottom: 20px;">Manage Menu</h1>

<style>
.menu-table {
    width: 100%;
    border-collapse: collapse;
}
.menu-table th, .menu-table td {
    border: 1px solid #ccc;
    padding: 8px;
}
.menu-table th {
    background: #eee;
}

.edit-panel {
    display: none;
    background: #fafafa;
    border-left: 4px solid black;
    padding: 20px;
    margin-top: 10px;
}

.edit-panel input,
.edit-panel textarea {
    width: 100%;
    padding: 8px;
    margin-bottom: 15px;
}
</style>

<!-- ADD MENU ITEM -->
<div class="form-box" style="background:white; padding:20px; border-radius:8px; border:1px solid #ccc; margin-bottom:25px;">
    <h3>Add New Menu Item</h3>
    
    <form method="POST" enctype="multipart/form-data" action="{% url 'admin_add_menu' %}">
        {% csrf_token %}

        <label>Name:</label>
        <input type="text" name="menuName" required>

        <label>Description:</label>
        <textarea name="description" rows="3" required></textarea>

        <label>Price:</label>
        <input type="number" step="0.01" name="price" required>

        <label>Image:</label>
        <input type="file" name="image_url" accept="image/*" required>

        <button type="submit" style="padding:8px 15px; background:black; color:white;">
            Add Menu Item
        </button>
    </form>
</div>

<!-- MENU LIST -->
<h3>Existing Menu Items</h3>

<table class="menu-table">
    <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Description</th>
        <th>Price (Rs)</th>
        <th>Action</th>
    </tr>

    {% for m in menu_items %}
    <tr>
        <td><img src="/media/{{ m.image_url }}" style="height:60px; border-radius:5px;"></td>
        <td>{{ m.menuName }}</td>
        <td>{{ m.description|truncatechars:50 }}</td>
        <td>{{ m.price }}</td>
        <td>
            <button onclick="toggleEdit('{{ m.menuID }}')">Manage</button>
        </td>
    </tr>

    <!-- INLINE EDIT PANEL -->
    <tr id="panel-{{ m.menuID }}" class="edit-panel">
        <td colspan="5">

            <!-- EDIT FORM -->
            <form method="POST" action="{% url 'admin_update_menu' m.menuID %}" enctype="multipart/form-data">
                {% csrf_token %}

                <h3>Edit Item</h3>

                <label>Name:</label>
                <input type="text" name="menuName" value="{{ m.menuName }}" required>

                <label>Description:</label>
                <textarea name="description" rows="3">{{ m.description }}</textarea>

                <label>Price:</label>
                <input type="number" step="0.01" name="price" value="{{ m.price }}" required>

                <label>Change Image:</label>
                <input type="file" name="image_url" accept="image/*">

                <button type="submit" style="padding:8px 15px; background:black; color:white; margin-right:10px;">
                    Save Changes
                </button>
            </form>

            <!-- DELETE FORM (separate!) -->
            <form method="POST" action="{% url 'admin_delete_menu' m.menuID %}" style="display:inline-block; margin-right:10px;">
                {% csrf_token %}
                <button type="submit" style="padding:8px 15px; background:red; color:white;">
                    Delete
                </button>
            </form>

            <button type="button" onclick="toggleEdit('{{ m.menuID }}')" style="padding:8px 15px;">
                Close
            </button>

        </td>
    </tr>

    {% endfor %}
</table>

<script>
let openPanel = null;

function toggleEdit(id) {
    const panel = document.getElementById("panel-" + id);

    if (openPanel && openPanel !== panel) {
        openPanel.style.display = "none";
    }

    panel.style.display = (panel.style.display === "table-row") ? "none" : "table-row";
    openPanel = panel;
}
</script>

{% endblock %}
