{% extends 'admin_site/base_admin.html' %}

{% block title %}Reservations{% endblock %}

{% block content %}
<h1 style="margin-bottom: 20px;">Reservations</h1>

<style>
/* Table styling */
.reservation-table {
    width: 100%;
    border-collapse: collapse;
}
.reservation-table th,
.reservation-table td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
}
.reservation-table th {
    background: #f0f0f0;
}

/* MODAL */
.modal-overlay {
    position: fixed;
    display: none;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.45);
    justify-content: center;
    align-items: center;
}
.modal-box {
    width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.modal-close {
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
}
.modal-section {
    margin-top: 15px;
    padding: 10px;
    background: #fafafa;
    border-radius: 6px;
}
.modal-section h3 {
    margin-top: 0;
}
</style>

<form method="GET" style="margin-bottom: 20px;">
    <input type="text" name="search" placeholder="Search reservation..." value="{{ search }}" style="padding: 8px; width: 250px;">
    <button type="submit" style="padding: 8px;">Search</button>
</form>

<table class="reservation-table">
    <tr>
        <th>Customer Name</th>
        <th>Phone</th>
        <th>Date</th>
        <th>Time</th>
        <th>Party Size</th>
        <th>Seating Choice</th>
        <th>Allergy Info</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>

    {% for r in reservations %}
    <tr>
        <td>{{ r.customer.user.first_name }} {{ r.customer.user.last_name }}</td>
        <td>{{ r.customer.user.phone_no }}</td>
        <td>{{ r.reservation_date }}</td>
        <td>{{ r.reservation_time }}</td>
        <td>{{ r.party_size }}</td>
        <td>{{ r.seating_choice }}</td>
        <td>{{ r.allergy_info }}</td>
        <td>{{ r.status }}</td>
        <td>
            <button onclick="openModal('{{ r.reservationID }}')">View</button>
            <button onclick="openEditModal('{{ r.reservationID }}')">Edit</button>
            <button onclick="openDeleteModal('{{ r.reservationID }}')" style="background:red; color:white;">Delete</button>
        </td>
    </tr>

    <!-- VIEW MODAL -->
    <div id="modal-{{ r.reservationID }}" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Reservation Details</h2>
                <span class="modal-close" onclick="closeModal('{{ r.reservationID }}')">×</span>
            </div>
            <div class="modal-section">
                <p><strong>Customer:</strong> {{ r.customer.user.first_name }} {{ r.customer.user.last_name }}</p>
                <p><strong>Phone:</strong> {{ r.customer.user.phone_no }}</p>
                <p><strong>Date:</strong> {{ r.reservation_date }}</p>
                <p><strong>Time:</strong> {{ r.reservation_time }}</p>
                <p><strong>Party Size:</strong> {{ r.party_size }}</p>
                <p><strong>Seating Choice:</strong> {{ r.seating_choice }}</p>
                <p><strong>Allergy Info:</strong> {{ r.allergy_info }}</p>
                <p><strong>Status:</strong> {{ r.status }}</p>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div id="edit-modal-{{ r.reservationID }}" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Edit Reservation</h2>
                <span class="modal-close" onclick="closeEditModal('{{ r.reservationID }}')">×</span>
            </div>
            <form method="POST" action="{% url 'admin_reservation_update' r.reservationID %}">
                {% csrf_token %}
                <label>Date:</label>
                <input type="date" name="reservation_date" value="{{ r.reservation_date }}"><br><br>

                <label>Time:</label>
                <input type="time" name="reservation_time" value="{{ r.reservation_time }}"><br><br>

                <label>Party Size:</label>
                <input type="number" name="party_size" value="{{ r.party_size }}" min="1"><br><br>

                <label>Seating Choice:</label>
                <input type="text" name="seating_choice" value="{{ r.seating_choice }}"><br><br>

                <label>Allergy Info:</label>
                <input type="text" name="allergy_info" value="{{ r.allergy_info }}"><br><br>

                <label>Status:</label>
                <input type="text" name="status" value="{{ r.status }}"><br><br>

                <button type="submit" style="padding:10px; background:black; color:white;">Save Changes</button>
                <button type="button" onclick="closeEditModal('{{ r.reservationID }}')" style="padding:10px;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- DELETE MODAL -->
    <div id="delete-modal-{{ r.reservationID }}" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h2>Delete Reservation</h2>
                <span class="modal-close" onclick="closeDeleteModal('{{ r.reservationID }}')">×</span>
            </div>
            <p>Are you sure you want to delete this reservation?</p>
            <form method="POST" action="{% url 'admin_reservation_delete' r.reservationID %}">
                {% csrf_token %}
                <button type="submit" style="padding:10px; background:red; color:white;">Yes, Delete</button>
                <button type="button" onclick="closeDeleteModal('{{ r.reservationID }}')" style="padding:10px;">Cancel</button>
            </form>
        </div>
    </div>

    {% endfor %}
</table>

<script>
function openModal(id) { document.getElementById("modal-" + id).style.display = "flex"; }
function closeModal(id) { document.getElementById("modal-" + id).style.display = "none"; }
function openEditModal(id) { document.getElementById("edit-modal-" + id).style.display = "flex"; }
function closeEditModal(id) { document.getElementById("edit-modal-" + id).style.display = "none"; }
function openDeleteModal(id) { document.getElementById("delete-modal-" + id).style.display = "flex"; }
function closeDeleteModal(id) { document.getElementById("delete-modal-" + id).style.display = "none"; }
</script>

{% endblock %}
